## 千问 LoRA 微调文本意图分类

基于千问模型（Qwen3-0.6B）的LoRA低秩微调，实现简单高效的文本意图分类任务。

### 核心功能 

- 数据自动预处理，适配千问 ChatML 格式指令微调 
- LoRA 低秩微调，仅训练模型部分核心层，节省显存与时间 
- 支持训练/推理自动分支（已训练适配器直接加载，无需重复训练） 
- 批量文本意图预测，输出清晰易读的结果

### 优化

不管推理时提示词怎样强制输出，还是会输出大量无关内容，有时预测不准确。于是尝试在训练时就将指令写清楚，如下：

```
f"<|im_start|>system\n现在进行意图分类任务，严格按照以下规则："
                        f"1.只输出标签库中的标签\n"
                        f"2.禁止输出除标签外的任何解释\n"
                        f"3.标签库：{label_str}\n"
                        f"<|im_end|>\n"  # 系统提示：告诉模型任务
                        f"<|im_start|>user\n{example['instruction'] + example['input']}<|im_end|>\n"  # 用户输入：instruction+input（input为空）
                        f"<|im_start|>assistant\n"
```

按照这样的指令进行训练，明确告诉模型怎样输出。

### 训练结果 & 测试结果

训练结果如下：  
![训练结果](训练结果)  
可以看出拟合效果非常不错了，测试用例覆盖所有意图，结果如下：

```
输入: 查询下周三我的日程安排是什么
预测意图: Alarm-UpdateThe

输入: 帮我播放《狂飙》第15集
预测意图: FilmTele-Play

输入: 今天天气不错，适合出门散步
预测意图: Weather-QueryThe

输入: 给我播放张敬轩的歌曲《春秋》
预测意图: Music-Play#

输入: 帮我打开客厅的空调，设置温度26度
预测意图: HomeAppliance-Control

输入: 帮我播放湖南卫视的《快乐大本营》最新一期
预测意图: Video-Play#

输入: 收听FM93.8交通广播的实时路况
预测意图: Radio-ListenThe

输入: 查询明天上海的天气情况，是否有雨
预测意图: Weather-QueryWeather

输入: 把明天早上7点的闹钟修改为7点30分
预测意图: Alarm-UpdateThe

输入: 播放《明朝那些事儿》的有声小说第10章
预测意图: Audio-Play#

输入: 帮我找到电影《流浪地球2》并播放
预测意图: FilmTele-Play

输入: 查询从北京到上海的高铁票，明天下午出发的
预测意图: Travel-QueryThe
```

可以看到，相比于未改训练时的指令的结果还是会输出一些无关字符，但是已经能够将文本意图清晰的输出，只有少量的无关字符。造成这种原因的是使用的模型容量较小，记不住**只输出纯标签、不续写**的强制约束，换用稍微大一些的模型能有所缓解。
