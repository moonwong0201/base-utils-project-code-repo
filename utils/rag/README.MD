## RAG 分步实现

### 知识库与用户查询

- 汽车知识手册.pdf

- 带 301 个问题的 json，reference 为页码，answer 为问题的结果

  示例：

  ```
  [
      {
          "question": "“前排座椅通风”的相关内容在第几页？",
          "answer": "",
          "reference": ""
      },
      {
          "question": "\"关于车辆的儿童安全座椅固定装置，在哪一页可以找到相关内容？\"",
          "answer": "",
          "reference": ""
      },
      ...
  ```

#### 关键词检索

**RAG_TFIDF.py**

**RAG_BM25.py**

- 功能描述：基于 **TF-IDF** 和 **BM25** 的汽车知识 RAG 检索，将汽车相关问题与 PDF 手册进行文本匹配，返回 Top1/Top10 相关 PDF 页面，并将结果保存在 json 中；

- 运行结果示例：

  ```
  [
      {
          "question": "“前排座椅通风”的相关内容在第几页？",
          "answer": "",
          "reference": [
              "page_117",
              "page_116",
              "page_115",
              "page_114",
              "page_113",
              "page_52",
              "page_107",
              "page_51",
              "page_53",
              "page_105"
          ]
      },
      ...
  ```

#### 向量检索

**RAG_BERT.py**

- 功能描述：基于 **BGE** 和 **JinaAI** 两种文本嵌入模型的汽车知识 RAG 检索，将汽车相关问题与 PDF 手册进行语义匹配，返回 Top1/Top10 相关 PDF 页面，并将结果保存在 json 中

**RAG_BERT_Segment.py**

- 功能描述：用同样的文本嵌入模型进行检索，但是将手册的内容进行了分块，分块来进行语义匹配，找出最相关的块，得到块对应的页码，保存在 json 中；
- 优化：相比于直接匹配整页内容，分块能够更加精准地找到对应的内容。

#### 重排序

**RAG_Rerank.py**

- 功能描述：将用BM25关键词检索和向量检索分别得到的 Top10 文档进行融合打分，选出得分最高的 3 个文档，然后再使用 **重排序** 模型，输入 **问题** 与 **文档** 对，选取出对于每个问题语义最为相关的文档为最终的回答依据，将结果保存在 json 中

#### RAG 问答

**RAG_Q&A.py**

- 功能描述：将问题和重排序得到的最相关的文本块拼接，构建提示词，送入大模型中，让大模型进行回答，保存最终的回答结果在 json 中；

- 运行结果示例：

  ```
  [
      {
          "question": "“前排座椅通风”的相关内容在第几页？",
          "answer": "根据提供的资料，\"前排座椅通风\"的相关内容在第115页。  因此，答案是：第115页。",
          "reference": "page_115"
      },
      {
          "question": "\"关于车辆的儿童安全座椅固定装置，在哪一页可以找到相关内容？\"",
          "answer": "根据提供的资料，可以找到相关内容的页码是第123页。  步骤如下： 1. 查看资料内容，寻找与“儿童安全座椅固定装置”相关的信息。 2. 在资料中发现有提到“ISOFIX固定装置”和“使用顶部系带固定装置”的内容。 3. 在资料末尾发现标注：“上述内容在第 123 页”。  因此，关于车辆的儿童安全座椅固定装置的相关内容可以在第123页找到。",
          "reference": "page_123"
      },
      {
          "question": "“打开前机舱盖”的相关信息在第几页？",
          "answer": "根据提供的资料，\"打开前机舱盖\"的相关信息在第 308 页。",
          "reference": "page_308"
      },
      {
          "question": "“打开前机舱盖”这个操作在哪一页？",
          "answer": "根据提供的资料，“打开前机舱盖”这个操作在页码307。  步骤解释： 1. 在资料中提到：“前机舱盖打开，请参见打开前机舱盖（页码307）”。 2. 因此，可以确定“打开前机舱盖”这个操作在页码307。",
          "reference": "page_329"
      },
      ...
  ```



最终的结果见 **submit_fusion_bge+bm25_rerank_retrieval_qwen.json**
